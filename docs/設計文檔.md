é€™æ˜¯ä¸€ä»½ç¶“éæœ€çµ‚å¯©æ ¸ã€æ•´åˆäº†é—œéµéŸ¿æ‡‰å¼è£œä¸ï¼ˆReactivity Patchï¼‰çš„å®Œæ•´æ–‡æª”ã€‚

æˆ‘å·²å°‡ç‰ˆæœ¬è™Ÿæ›´æ–°ç‚º v1.0.3ã€‚ä¸»è¦çš„è®Šæ›´æ˜¯å°‡ ã€Œéšæ®µå…«ã€ ä¸­çš„é é¢é‚è¼¯é€²è¡Œäº†ä¿®æ­£ï¼ŒåŠ å…¥äº† $effect åŒæ­¥æ©Ÿåˆ¶ã€‚é€™æ˜¯ SvelteKit é–‹ç™¼ä¸­æ¥µæ˜“è¢«å¿½ç•¥ä½†è‡³é—œé‡è¦çš„ç´°ç¯€ï¼šç¢ºä¿ç•¶è·¯ç”±åƒæ•¸è®ŠåŒ–ï¼ˆå°è‡´ load å‡½æ•¸é‡æ–°é‹è¡Œï¼‰æ™‚ï¼ŒService å…§éƒ¨çš„ç‹€æ…‹èƒ½èˆ‡æœ€æ–°çš„æ•¸æ“šä¿æŒåŒæ­¥ã€‚

æ‚¨å¯ä»¥ç›´æ¥è¤‡è£½ä»¥ä¸‹å…§å®¹ä¿å­˜ç‚º ARCHITECTURE.mdã€‚

ğŸ“˜ Svelte 5 ä¼æ¥­ç´šæ‡‰ç”¨æ¶æ§‹è¨­è¨ˆæ¨™æº– (Enterprise Svelte 5 Master Blueprint)

æ–‡æª”ç‹€æ…‹ï¼šğŸŸ¢ æ­£å¼ç™¼å¸ƒ (v1.0.3)

é©ç”¨æŠ€è¡“æ£§ï¼šSvelte 5 (Runes), SvelteKit 2.0, TypeScript, Tailwind CSS, Vitest, Superforms, Paraglide-JS

è¨­è¨ˆç›®æ¨™ï¼šæ§‹å»ºå¯æ“´å±•ã€é«˜å…§èšã€ä½è€¦åˆã€æ˜“æ¸¬è©¦çš„å¤§å‹å‰ç«¯æ‡‰ç”¨ç³»çµ±ã€‚

1. åŸ·è¡Œæ‘˜è¦ (Executive Summary)

æœ¬æ¶æ§‹æ¡ç”¨ é ˜åŸŸé©…å‹•è¨­è¨ˆ (DDD) çš„ç›®éŒ„çµæ§‹ï¼Œåˆ©ç”¨ Svelte 5 çš„ Universal Reactivity (Runes) é€²è¡Œç´°ç²’åº¦çš„ç‹€æ…‹ç®¡ç†ï¼Œä¸¦é€šé ä¾è³´æ³¨å…¥ (DI) å¯¦ç¾æ¥­å‹™é‚è¼¯èˆ‡ UI çš„å¾¹åº•è§£è€¦ã€‚

æ ¸å¿ƒåŸå‰‡ï¼š

å¥‘ç´„å„ªå…ˆ (Contract-First)ï¼šåœ¨å¯« UI ä¹‹å‰ï¼Œå¿…é ˆå…ˆå®šç¾© TypeScript æ¥å£ã€‚

å’†å“®å¼æ¶æ§‹ (Screaming Architecture)ï¼šç›®éŒ„çµæ§‹æ‡‰åæ˜ æ¥­å‹™é ˜åŸŸï¼ˆå¦‚ auth, inventoryï¼‰ï¼Œè€ŒéæŠ€è¡“å¯¦ç¾ã€‚

é‚è¼¯å¤–ç½® (Logic Externalization)ï¼šUI çµ„ä»¶ (.svelte) åƒ…è² è²¬æ¸²æŸ“ï¼Œæ¥­å‹™é‚è¼¯å¿…é ˆå°è£åœ¨ Service é¡ (.svelte.ts) ä¸­ã€‚

é˜²è…å±¤è¨­è¨ˆ (Anti-Corruption Layer)ï¼šUI ä¸ç›´æ¥èª¿ç”¨ APIï¼Œå¿…é ˆé€šé Repository å±¤ã€‚

2. ç³»çµ±ç›®éŒ„çµæ§‹ (System Architecture)
   code
   Text
   download
   content_copy
   expand_less
   src/
   â”œâ”€â”€ lib/
   â”‚ â”œâ”€â”€ config/ # [é…ç½®å±¤] é¡å‹å®‰å…¨çš„ç’°å¢ƒè®Šé‡å°è£
   â”‚ â”œâ”€â”€ core/ # [æ ¸å¿ƒå±¤] åŸºç¤è¨­æ–½ (èˆ‡å…·é«”æ¥­å‹™ç„¡é—œ)
   â”‚ â”‚ â”œâ”€â”€ api/ # HTTP å®¢æˆ¶ç«¯å°è£
   â”‚ â”‚ â”œâ”€â”€ context/ # ä¾è³´æ³¨å…¥çš„ Symbol Keys
   â”‚ â”‚ â””â”€â”€ i18n/ # åœ‹éš›åŒ–é…ç½® (Paraglide)
   â”‚ â”œâ”€â”€ ui/ # [å±•ç¤ºå±¤] åŸå­çµ„ä»¶åº« (Design System)
   â”‚ â”‚ â”œâ”€â”€ primitives/ # åŸºç¤å…ƒä»¶ (Button, Modal, Input)
   â”‚ â”‚ â””â”€â”€ layouts/ # é€šç”¨ä½ˆå±€
   â”‚ â”œâ”€â”€ domains/ # [é ˜åŸŸå±¤] æ ¸å¿ƒæ¥­å‹™æ¨¡å¡Š (DDD)
   â”‚ â”‚ â”œâ”€â”€ auth/ # èº«ä»½é©—è­‰ä¸Šä¸‹æ–‡
   â”‚ â”‚ â”œâ”€â”€ inventory/ # åº«å­˜ä¸Šä¸‹æ–‡
   â”‚ â”‚ â””â”€â”€ users/ # ç”¨æˆ¶ä¸Šä¸‹æ–‡
   â”‚ â”‚ â”œâ”€â”€ components/ # è©²é ˜åŸŸå°ˆç”¨ UI
   â”‚ â”‚ â”œâ”€â”€ models/ # æ•¸æ“šå¥‘ç´„ (Interfaces & DTOs, Schemas)
   â”‚ â”‚ â”œâ”€â”€ services/ # æ¥­å‹™é‚è¼¯é¡ (.svelte.ts)
   â”‚ â”‚ â””â”€â”€ repositories/ # æ•¸æ“šç²å–é©é…å™¨
   â”‚ â””â”€â”€ server/ # [å¾Œç«¯å±¤] åƒ…æœå‹™ç«¯å¯è¦‹ (Secrets, DB)
   â””â”€â”€ routes/ # [è·¯ç”±å±¤] SvelteKit è† æ°´ä»£ç¢¼ (Loaders & Page Assembly)
3. è©³ç´°å¯¦æ–½éšæ®µ (Implementation Phases)
   éšæ®µä¸€ï¼šå·¥ç¨‹åˆå§‹åŒ– (Foundation)

ç›®æ¨™ï¼šå»ºç«‹å¼·é¡å‹ã€è·¯å¾‘åˆ¥åå®Œå–„çš„é …ç›®éª¨æ¶ã€‚

code
Bash
download
content_copy
expand_less
npm create svelte@latest my-enterprise-app

# é¸é …: Skeleton Project, TypeScript, Prettier, ESLint, Vitest

npx svelte-add@latest tailwindcss
npm install sveltekit-superforms zod @inlang/paraglide-js-adapter-sveltekit

é…ç½®è·¯å¾‘åˆ¥å (svelte.config.js & tsconfig.json)ï¼š

$core: src/lib/core

$ui: src/lib/ui

$domains: src/lib/domains

$config: src/lib/config

$server: src/lib/server

$paraglide: src/paraglide

éšæ®µäºŒï¼šç’°å¢ƒé…ç½®ç­–ç•¥ (Configuration Strategy)

åŸå‰‡ï¼šåš´ç¦åœ¨ä»£ç¢¼ä¸­ç›´æ¥ä½¿ç”¨ $envã€‚å¿…é ˆå°è£é…ç½®ä»¥ä¿è­‰é¡å‹å®‰å…¨ã€‚

2.1 å…¬é–‹é…ç½® (src/lib/config/env.public.ts)

code
TypeScript
download
content_copy
expand_less
import { PUBLIC_API_BASE } from '$env/static/public';

if (!PUBLIC_API_BASE) throw new Error('FATAL: PUBLIC_API_BASE is missing');

export const publicConfig = {
apiBase: PUBLIC_API_BASE,
isDev: import.meta.env.DEV
};

2.2 ç§æœ‰é…ç½® (src/lib/config/env.private.ts)

code
TypeScript
download
content_copy
expand_less
import { API_SECRET_KEY } from '$env/static/private';

if (!API_SECRET_KEY) throw new Error('Missing API_SECRET_KEY');

export const privateConfig = { apiSecret: API_SECRET_KEY };
éšæ®µä¸‰ï¼šé ˜åŸŸå»ºæ¨¡ (Domain Modeling)

åŸå‰‡ï¼šå®šç¾©æ•¸æ“šå¥‘ç´„æ˜¯é–‹ç™¼çš„ç¬¬ä¸€æ­¥ã€‚

æ–‡ä»¶ï¼šsrc/lib/domains/todo/models/todo.types.ts

code
TypeScript
download
content_copy
expand_less
export interface TodoItem {
id: string;
title: string;
completed: boolean;
}
export interface CreateTodoDto {
title: string;
}
éšæ®µå››ï¼šåŸºç¤è¨­æ–½èˆ‡é˜²è…å±¤ (Infrastructure)

åŸå‰‡ï¼šä½¿ç”¨ Repository æ¨¡å¼éš”é›¢æ•¸æ“šæºã€‚

4.1 å®šç¾©æ¥å£ (todo.repository.ts)

code
TypeScript
download
content_copy
expand_less
import type { TodoItem, CreateTodoDto } from '../models/todo.types';

export interface TodoRepository {
getAll(): Promise<TodoItem[]>;
create(dto: CreateTodoDto): Promise<TodoItem>;
}

4.2 å¯¦ç¾ HTTP Repository (todo.repository.http.ts)

code
TypeScript
download
content_copy
expand_less
import type { TodoRepository } from './todo.repository';
import { publicConfig } from '$config/env.public';

export class HttpTodoRepository implements TodoRepository {
constructor(private fetchFn: typeof fetch) {}

    async getAll() {
        const res = await this.fetchFn(`${publicConfig.apiBase}/todos`);
        if (!res.ok) throw new Error(`API Error: ${res.statusText}`);
        return res.json();
    }
    // ... create implementation

}
éšæ®µäº”ï¼šæ¥­å‹™é‚è¼¯æœå‹™ (Domain Services)

åŸå‰‡ï¼šæ¶æ§‹æ ¸å¿ƒã€‚ä½¿ç”¨ .svelte.ts é¡å°è£ç‹€æ…‹ï¼Œåˆ©ç”¨ Svelte 5 Runesã€‚

æ–‡ä»¶ï¼šsrc/lib/domains/todo/services/todo.service.svelte.ts

code
TypeScript
download
content_copy
expand_less
import type { TodoRepository } from '../repositories/todo.repository';
import type { TodoItem } from '../models/todo.types';

export class TodoService {
items = $state<TodoItem[]>([]);
loading = $state(false);
error = $state<string | null>(null);

    // Derived state
    get completedCount() {
        return this.items.filter(t => t.completed).length;
    }

    constructor(private repo: TodoRepository, initialData: TodoItem[] = []) {
        this.items = initialData;
    }

    async loadTodos() {
        this.loading = true;
        try {
            this.items = await this.repo.getAll();
        } catch (err) {
            this.error = (err as Error).message;
        } finally {
            this.loading = false;
        }
    }

    toggle(id: string) {
        const todo = this.items.find(t => t.id === id);
        if (todo) todo.completed = !todo.completed;
    }

}
éšæ®µå…­ï¼šä¾è³´æ³¨å…¥ç³»çµ± (Dependency Injection)

æ–‡ä»¶ï¼šsrc/lib/core/context/keys.ts

code
TypeScript
download
content_copy
expand_less
export const TODO_SERVICE_KEY = Symbol('TODO_SERVICE');
éšæ®µä¸ƒï¼šåŸå­çµ„ä»¶é–‹ç™¼ (UI Primitives)

åŸå‰‡ï¼šä½¿ç”¨ Snippets æ›¿ä»£ Slotsã€‚

æ–‡ä»¶ï¼šsrc/lib/ui/primitives/Button.svelte

code
Svelte
download
content_copy
expand_less

<script lang="ts">
    import type { Snippet } from 'svelte';
    
    interface Props {
        children: Snippet;
        onclick?: (e: MouseEvent) => void;
        variant?: 'primary' | 'danger';
    }
    
    let { children, onclick, variant = 'primary' }: Props = $props();
    
    const styles = variant === 'primary' ? "bg-blue-600 text-white" : "bg-red-600 text-white";
</script>

<button class="px-4 py-2 rounded transition-colors {styles}" {onclick}>
{@render children()}
</button>
éšæ®µå…«ï¼šé é¢é›†æˆ (Page Integration)

åŸå‰‡ï¼šroutes/ å±¤åªè² è²¬æ•¸æ“šåŠ è¼‰å’Œä¾è³´çµ„è£ã€‚
é—œéµä¿®æ­£ï¼šå¿…é ˆä½¿ç”¨ $effect ç¢ºä¿å®¢æˆ¶ç«¯å°èˆªï¼ˆClient-side Navigationï¼‰æ™‚ï¼ŒService ç‹€æ…‹èƒ½èˆ‡ SvelteKit çš„ data ä¿æŒåŒæ­¥ã€‚

8.1 æœå‹™ç«¯é å– (+page.ts)

code
TypeScript
download
content_copy
expand_less
import { HttpTodoRepository } from '$domains/todo/repositories/todo.repository.http';

export const load = async ({ fetch }) => {
const repo = new HttpTodoRepository(fetch);
const items = await repo.getAll();
return { items };
};

8.2 é é¢è¦–åœ– (+page.svelte)

code
Svelte
download
content_copy
expand_less

<script lang="ts">
    import { setContext } from 'svelte';
    import { TodoService } from '$domains/todo/services/todo.service.svelte';
    import { HttpTodoRepository } from '$domains/todo/repositories/todo.repository.http';
    import { TODO_SERVICE_KEY } from '$core/context/keys';
    import TodoList from '$domains/todo/components/TodoList.svelte';

    let { data } = $props();

    // 1. ä¾è³´çµ„è£ (SSR + Hydration)
    // æ³¨æ„ï¼šæ­¤è™•çš„ä»£ç¢¼åœ¨çµ„ä»¶æ›è¼‰å¾Œï¼Œè‹¥åƒ…æ˜¯åƒæ•¸è®Šæ›´ï¼Œä¸æœƒé‡æ–°åŸ·è¡Œ
    const repo = new HttpTodoRepository(fetch); 
    const service = new TodoService(repo, data.items);
    
    // 2. æ³¨å…¥ä¸Šä¸‹æ–‡
    setContext(TODO_SERVICE_KEY, service);

    // 3. [é—œéµè£œä¸] éŸ¿æ‡‰å¼æ•¸æ“šåŒæ­¥
    // ç•¶ SvelteKit è·¯ç”±ç™¼ç”Ÿè®ŠåŒ–å°è‡´ load å‡½æ•¸é‡æ–°é‹è¡Œä¸¦æ›´æ–° data æ™‚ï¼Œ
    // æˆ‘å€‘å¿…é ˆæ‰‹å‹•å°‡æ–°æ•¸æ“šåŒæ­¥åˆ° Service ä¸­ï¼Œå› ç‚ºä¸Šé¢çš„ constructor ä¸æœƒå†æ¬¡é‹è¡Œã€‚
    $effect(() => {
        service.items = data.items;
    });
</script>

<main class="p-8">
    {#if service.error}
        <div class="text-red-500 p-4 border border-red-200 rounded">{service.error}</div>
    {/if}
    <TodoList />
</main>
éšæ®µä¹ï¼šé ˜åŸŸçµ„ä»¶å¯¦ç¾ (Domain Components)

æ–‡ä»¶ï¼šsrc/lib/domains/todo/components/TodoList.svelte

code
Svelte
download
content_copy
expand_less

<script lang="ts">
    import { getContext } from 'svelte';
    import { TODO_SERVICE_KEY } from '$core/context/keys';
    import type { TodoService } from '../services/todo.service.svelte';
    import Button from '$ui/primitives/Button.svelte';

    const service = getContext<TodoService>(TODO_SERVICE_KEY);
</script>

<div class="space-y-2">
    {#each service.items as todo (todo.id)}
        <div class="flex justify-between items-center border p-3 rounded">
            <span class:line-through={todo.completed}>{todo.title}</span>
            <Button onclick={() => service.toggle(todo.id)} variant={todo.completed ? 'danger' : 'primary'}>
                {todo.completed ? 'Undo' : 'Done'}
            </Button>
        </div>
    {/each}
</div>
éšæ®µåï¼šæ¸¬è©¦ç­–ç•¥ (Testing Strategy)

å–®å…ƒæ¸¬è©¦ï¼šsrc/lib/domains/todo/services/todo.service.test.ts

code
TypeScript
download
content_copy
expand_less
import { describe, it, expect, vi } from 'vitest';
import { TodoService } from './todo.service.svelte';

const mockRepo = { getAll: vi.fn(), create: vi.fn() };

describe('TodoService', () => {
it('toggles status', () => {
const service = new TodoService(mockRepo, [{ id: '1', title: 'T', completed: false }]);
service.toggle('1');
expect(service.items[0].completed).toBe(true);
});
});
éšæ®µåä¸€ï¼šè¡¨å–®èˆ‡æ•¸æ“šå¯«å…¥ (Forms & Mutations)

åŸå‰‡ï¼šä½¿ç”¨ Superforms + Zod é€²è¡Œç©©å¥çš„è¡¨å–®è™•ç†ã€‚

11.1 å®šç¾© Schema (src/lib/domains/todo/models/todo.schema.ts)

code
TypeScript
download
content_copy
expand_less
import { z } from 'zod';
export const createTodoSchema = z.object({
title: z.string().min(2, 'æ¨™é¡Œè‡³å°‘éœ€è¦ 2 å€‹å­—ç¬¦')
});

11.2 è¡¨å–®å‹•ä½œ (Server Side) (+page.server.ts)

code
TypeScript
download
content_copy
expand_less
import { fail } from '@sveltejs/kit';
import { superValidate } from 'sveltekit-superforms';
import { zod } from 'sveltekit-superforms/adapters';
import { createTodoSchema } from '$domains/todo/models/todo.schema';
import { HttpTodoRepository } from '$domains/todo/repositories/todo.repository.http';

export const load = async () => {
// åˆå§‹åŒ–ç©ºè¡¨å–®
const form = await superValidate(zod(createTodoSchema));
return { form };
};

export const actions = {
default: async ({ request, fetch }) => {
const form = await superValidate(request, zod(createTodoSchema));
if (!form.valid) return fail(400, { form });

        const repo = new HttpTodoRepository(fetch);
        await repo.create({ title: form.data.title });

        return { form };
    }

};

11.3 è¡¨å–®ç¶å®š (Client Side) (+page.svelte è£œå……)

code
Svelte
download
content_copy
expand_less

<script lang="ts">
    import { superForm } from 'sveltekit-superforms';
    // å¾ props ç²å– load/action è¿”å›çš„æ•¸æ“š
    let { data } = $props();
    
    // ç¶å®š Superform
    const { form, errors, enhance } = superForm(data.form, {
        resetForm: true,
        // å¯ä»¥åœ¨æ­¤è™•ç† onResult ç­‰å®¢æˆ¶ç«¯é‚è¼¯
    });
</script>

<form method="POST" use:enhance class="mb-6 flex gap-2">
    <input 
        name="title" 
        bind:value={$form.title} 
        class="border p-2 rounded" 
        placeholder="New Todo..."
    />
    <button class="bg-blue-600 text-white px-4 py-2 rounded">Add</button>
</form>
{#if $errors.title}<span class="text-red-500">{$errors.title}</span>{/if}
éšæ®µåäºŒï¼šåœ‹éš›åŒ–èˆ‡çµ„ä»¶åº« (I18n & Packaging)

12.1 åœ‹éš›åŒ– (Paraglide JS)

ä½¿ç”¨ src/lib/i18n/messages/en.json ç®¡ç†ç¿»è­¯ã€‚

åœ¨çµ„ä»¶ä¸­ä½¿ç”¨ï¼š

code
Svelte
download
content_copy
expand_less

<script>
  import * as m from '$paraglide/messages';
</script>
<h1>{m.hello_world()}</h1>

12.2 çµ„ä»¶åº«ç™¼å¸ƒ

å¦‚æœ $ui ç›®éŒ„ä¸‹çš„åŸå­çµ„ä»¶è¶¨æ–¼æˆç†Ÿï¼Œä½¿ç”¨ npx svelte-package -i src/lib/ui -o dist æ‰“åŒ…ä¸¦ç™¼å¸ƒåˆ°ç§æœ‰ NPMï¼Œä¾›å…¶ä»–é …ç›®è¤‡ç”¨ã€‚

4. é–‹ç™¼è¦ç¯„æª¢æŸ¥æ¸…å–® (Dev Checklist)

åœ¨æäº¤ Pull Request ä¹‹å‰ï¼Œè«‹ç¢ºä¿ï¼š

ç›®éŒ„è¦ç¯„ï¼šæ–‡ä»¶æ˜¯å¦æ”¾åœ¨æ­£ç¢ºçš„ $domains/[module] ä¸‹ï¼Ÿ

é‚è¼¯åˆ†é›¢ï¼šUI çµ„ä»¶æ˜¯å¦åªåŒ…å«æ¸²æŸ“é‚è¼¯ï¼Ÿè¤‡é›œé‚è¼¯æ˜¯å¦å·²ç§»è‡³ Serviceï¼Ÿ

é¡å‹å®‰å…¨ï¼šæ˜¯å¦å®šç¾©äº† TypeScript æ¥å£ï¼Ÿåš´ç¦ä½¿ç”¨ anyã€‚

é…ç½®å®‰å…¨ï¼šæ˜¯å¦é€šé $config è®€å–ç’°å¢ƒè®Šé‡ï¼Ÿ

èªæ³•è¦ç¯„ï¼šæ˜¯å¦ä½¿ç”¨äº† Svelte 5 çš„ $props, $state, snippetï¼Ÿ

æ•¸æ“šåŒæ­¥ï¼šåœ¨ +page.svelte ä¸­ï¼Œæ˜¯å¦ä½¿ç”¨ $effect è™•ç†äº† data è®Šæ›´å°è‡´çš„ Service ç‹€æ…‹åŒæ­¥ï¼Ÿ

è¡¨å–®è¦ç¯„ï¼šæ•¸æ“šå¯«å…¥æ˜¯å¦ä½¿ç”¨äº† superforms + zodï¼Ÿ

æ¸¬è©¦è¦†è“‹ï¼šæ˜¯å¦ç‚º Service ç·¨å¯«äº†å–®å…ƒæ¸¬è©¦ï¼Ÿ

5. éŒ¯èª¤è™•ç†è¦ç¯„ (Error Handling)

API å±¤ï¼šRepository æ‹‹å‡ºæ¨™æº– Error å°è±¡ã€‚

Service å±¤ï¼šæ•ç²éŒ¯èª¤ï¼Œè¨­ç½® error ç‹€æ…‹ (ä¸æ‹‹å‡º)ã€‚

UI å±¤ï¼š

å±€éƒ¨éŒ¯èª¤ï¼šç›£è½ service.errorï¼Œé¡¯ç¤º Toast æˆ–éŒ¯èª¤çµ„ä»¶ã€‚

å…¨å±€å´©æ½°ï¼šä½¿ç”¨ src/routes/+error.svelte å…œåº•ã€‚
