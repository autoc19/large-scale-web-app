# ğŸš€ Svelte 5 èªæ³•é·ç§»èˆ‡ç·¨ç¢¼è¦ç¯„ (Strict Svelte 5 Rules)

**ç‰ˆæœ¬**ï¼š 1.1 (Finalized)
**é©ç”¨ç¯„åœ**ï¼š æ‰€æœ‰ `.svelte`, `.ts`, `.js` æ–‡ä»¶
**åŸ·è¡Œç´šåˆ¥**ï¼š ğŸ”´ å¼·åˆ¶ (Mandatory)
**åƒè€ƒ**ï¼š Svelte 5 Official Documentation & GitHub

---

## 1. éŸ¿æ‡‰å¼ç‹€æ…‹ (Reactivity)

**æ ¸å¿ƒåŸå‰‡**ï¼š åš´ç¦ä½¿ç”¨ Svelte 4 çš„é ‚å±¤ `let` è®Šé‡è‡ªå‹•éŸ¿æ‡‰å’Œ `writable` storeã€‚**å¿…é ˆ**å…¨é¢æ“æŠ± Runesã€‚

| èˆŠèªæ³• (Svelte 4) âŒ | æ–°èªæ³• (Svelte 5) âœ… | èªªæ˜ |
| :--- | :--- | :--- |
| `let count = 0;` | `let count = $state(0);` | **åŸºç¤ç‹€æ…‹**ï¼šä½¿ç”¨ `$state` å‰µå»ºéŸ¿æ‡‰å¼ä»£ç†ã€‚ |
| `$: double = count * 2;` | `let double = $derived(count * 2);` | **è¡ç”Ÿç‹€æ…‹**ï¼šä½¿ç”¨ `$derived` è‡ªå‹•è¿½è¹¤ä¾è³´ã€‚ |
| `$: { console.log(c); }` | `$effect(() => { console.log(c); });` | **å‰¯ä½œç”¨**ï¼šDOM æ›´æ–°å¾ŒåŸ·è¡Œã€‚ |
| `export let data;` | `let { data } = $props();` | **Props**ï¼šä½¿ç”¨ `$props` è§£æ§‹æ¥æ”¶åƒæ•¸ã€‚ |
| `export let val;` (ç¶å®š) | `let { val = $bindable() } = $props();` | **é›™å‘ç¶å®š**ï¼šâš ï¸ å¿…é ˆé¡¯å¼ä½¿ç”¨ `$bindable()`ï¼Œå¦å‰‡çˆ¶çµ„ä»¶ç„¡æ³•ä½¿ç”¨ `bind:val`ã€‚ |
| `import { writable } ...` | `class Store { val = $state(0) }` | **ç‹€æ…‹ç®¡ç†**ï¼šä½¿ç”¨ `.svelte.ts` é¡ + `$state` æ›¿ä»£ Storeã€‚ |

**IDE/AI è¦å‰‡ï¼š**
1.  æª¢æ¸¬åˆ° `export let` æ™‚ï¼Œå ±éŒ¯ä¸¦æç¤ºæ›¿æ›ç‚º `$props()`ã€‚
2.  å¦‚æœè®Šé‡éœ€è¦è¢«çˆ¶çµ„ä»¶ç¶å®š (`bind:prop`)ï¼Œå¿…é ˆå°‡å…¶å®šç¾©ç‚º `$bindable()`ã€‚
3.  æª¢æ¸¬åˆ° `$: ` èªæ³•æ™‚ï¼Œå ±éŒ¯ä¸¦æç¤ºä½¿ç”¨ `$derived` æˆ– `$effect`ã€‚

---

## 2. çµ„ä»¶é€šä¿¡èˆ‡è¦–åœ– (Props & Snippets)

**æ ¸å¿ƒåŸå‰‡**ï¼š `<slot>` æ¨™ç±¤å·²è¢«**å¾¹åº•å»¢æ£„**ã€‚å¿…é ˆä½¿ç”¨ Snippet ç³»çµ±ã€‚

| èˆŠèªæ³• (Svelte 4) âŒ | æ–°èªæ³• (Svelte 5) âœ… | èªªæ˜ |
| :--- | :--- | :--- |
| `<slot />` | `{@render children()}` | **é»˜èªæ’æ§½**ï¼š`children` æ˜¯ `$props` çš„éš±å¼å±¬æ€§ã€‚ |
| `<slot name="header" />` | `{@render header()}` | **å…·åæ’æ§½**ï¼šä½œç‚º Snippet å±¬æ€§å‚³éã€‚ |
| `<div slot="header">` | `{#snippet header()}<div>...</div>{/snippet}` | **çˆ¶çµ„ä»¶å®šç¾©**ï¼šä½¿ç”¨ `#snippet` èªæ³•å®šç¾©ç‰‡æ®µä¸¦å‚³éã€‚ |
| `$$props`, `$$restProps` | `let { ...rest } = $props();` | **å‰©é¤˜å±¬æ€§**ï¼šç›´æ¥åœ¨ `$props` ä¸­è§£æ§‹ã€‚ |

**IDE/AI è¦å‰‡ï¼š**
1.  åš´ç¦ä½¿ç”¨ `<slot>` æ¨™ç±¤ã€‚
2.  åœ¨ `$props()` æ¥å£å®šç¾©ä¸­ï¼ŒSnippet é¡å‹å®šç¾©å¦‚ä¸‹ï¼š
    ```typescript
    import type { Snippet } from 'svelte';
    interface Props {
        children?: Snippet;
    }
    ```

---

## 3. äº‹ä»¶è™•ç† (Event Handling)

**æ ¸å¿ƒåŸå‰‡**ï¼š `on:` æŒ‡ä»¤èˆ‡ä¿®é£¾ç¬¦å·²è¢«å»¢æ£„ã€‚äº‹ä»¶ç¾åœ¨æ˜¯æ¨™æº– HTML å±¬æ€§ã€‚

| èˆŠèªæ³• (Svelte 4) âŒ | æ–°èªæ³• (Svelte 5) âœ… | èªªæ˜ |
| :--- | :--- | :--- |
| `<btn on:click={fn}>` | `<btn onclick={fn}>` | **DOM äº‹ä»¶**ï¼šå»å†’è™Ÿï¼Œä½¿ç”¨å…¨å°å¯«æ¨™æº–å±¬æ€§ã€‚ |
| `on:click|preventDefault` | `onclick={(e) => { e.preventDefault(); fn(); }}` | **ä¿®é£¾ç¬¦**ï¼šâŒ å»¢æ£„ã€‚å¿…é ˆåœ¨è™•ç†å‡½æ•¸å…§æ‰‹å‹•èª¿ç”¨ APIã€‚ |
| `dispatch('save', data)` | `props.onSave(data)` | **çµ„ä»¶äº‹ä»¶**ï¼šâŒ `createEventDispatcher` å»¢æ£„ã€‚æ”¹ç”¨å›èª¿å‡½æ•¸ Propsã€‚ |
| `on:custom={handler}` | `onCustom={handler}` | **ç›£è½çµ„ä»¶**ï¼šç›´æ¥å‚³éå‡½æ•¸çµ¦ Propsã€‚ |

**IDE/AI è¦å‰‡ï¼š**
1.  æª¢æ¸¬åˆ° `on:` é–‹é ­çš„å±¬æ€§ï¼Œå¼·åˆ¶ä¿®å¾©ç‚º `on...` (å¦‚ `onclick`, `oninput`)ã€‚
2.  æª¢æ¸¬åˆ°äº‹ä»¶ä¿®é£¾ç¬¦ (å¦‚ `|preventDefault`, `|stopPropagation`)ï¼Œæç¤ºåœ¨å‡½æ•¸å…§éƒ¨è™•ç†ã€‚
3.  åš´ç¦å¼•å…¥ `createEventDispatcher`ã€‚

---

## 4. çµ„ä»¶ç”Ÿå‘½é€±æœŸ (Lifecycle)

**æ ¸å¿ƒåŸå‰‡**ï¼š `$effect` å–ä»£äº†å¤§éƒ¨åˆ†æ›´æ–°ç›¸é—œçš„ç”Ÿå‘½é€±æœŸã€‚

| èˆŠèªæ³• (Svelte 4) âŒ | æ–°èªæ³• (Svelte 5) âœ… | èªªæ˜ |
| :--- | :--- | :--- |
| `onMount` | `onMount` æˆ– `$effect` | `onMount` ä»å¯ç”¨æ–¼**ééŸ¿æ‡‰å¼**åˆå§‹åŒ–ï¼Œä½† `$effect` æ›´é€šç”¨ã€‚ |
| `afterUpdate` | `$effect(() => { ... })` | é»˜èªåœ¨ DOM æ›´æ–°å¾Œé‹è¡Œã€‚ |
| `onDestroy` | `$effect(() => { return () => { /* cleanup */ } })` | **æ¸…ç†å‡½æ•¸**ï¼š`$effect` çš„è¿”å›å€¼å³ç‚ºæ¸…ç†å‡½æ•¸ã€‚ |

---

## 5. é‡è¦è£œå…… (Crucial Additions)

### 5.1 Class å±¬æ€§è™•ç†
ç”±æ–¼ `class` æ˜¯ JS ä¿ç•™å­—ï¼Œåœ¨è§£æ§‹ `$props` æ™‚éœ€è¦é‡å‘½åæˆ–è™•ç†ã€‚

* **æ¨è–¦å¯«æ³•**ï¼š
    ```typescript
    let { class: className, ...rest } = $props();
    ```
    ```html
    <div class={className} {...rest}></div>
    ```

### 5.2 èª¿è©¦ (Debugging)
* ä½¿ç”¨ `$inspect(variable)` ä»£æ›¿ `console.log` ä¾†è¿½è¹¤éŸ¿æ‡‰å¼ä¾è³´çš„è®ŠåŒ–ï¼ˆåƒ…åœ¨é–‹ç™¼æ¨¡å¼æœ‰æ•ˆï¼‰ã€‚

---

## 6. æ¨™æº–çµ„ä»¶ç¯„æœ¬ (Svelte 5 Standard Template)

```svelte
<script lang="ts">
  import type { Snippet } from 'svelte';

  // 1. Props å®šç¾© (Explicit Type Interface)
  interface Props {
    count: number;
    isOpen?: boolean;             // å¯é¸å±¬æ€§
    value?: string;
    children?: Snippet;           // é»˜èªæ’æ§½
    header?: Snippet<[string]>;   // å¸¶åƒæ•¸çš„ Snippet
    onToggle: (val: boolean) => void; // äº‹ä»¶å›èª¿
    [key: string]: any;           // å…è¨±ä»»æ„å‰©é¤˜å±¬æ€§
  }

  // 2. Props è§£æ§‹ (å« $bindable å’Œ é‡å‘½å)
  let { 
    count, 
    isOpen = false, 
    value = $bindable(''), // âš ï¸ é—œéµï¼šå…è¨±é›™å‘ç¶å®š bind:value
    children, 
    header,
    onToggle,
    class: className,      // âš ï¸ é—œéµï¼šclass é‡å‘½å
    ...rest                // å‰©é¤˜å±¬æ€§
  }: Props = $props();

  // 3. éŸ¿æ‡‰å¼ç‹€æ…‹
  let internalState = $state(false);

  // 4. è¡ç”Ÿç‹€æ…‹
  let double = $derived(count * 2);

  // 5. å‰¯ä½œç”¨èˆ‡æ¸…ç†
  $effect(() => {
    console.log('Count updated:', count);
    // é–‹ç™¼èª¿è©¦
    $inspect(internalState); 
    
    return () => console.log('Cleanup');
  });

  function handleClick(event: MouseEvent) {
    event.preventDefault(); // âš ï¸ é—œéµï¼šæ‰‹å‹•è™•ç†ä¿®é£¾ç¬¦
    internalState = !internalState;
    onToggle(internalState);
  }
</script>

<div class={className} {...rest}>
  <button onclick={handleClick}>
    Double is {double}
  </button>

  <input bind:value={value} placeholder="Bindable input" />

  <div class="content">
    {@render children?.()}
  </div>
  
  {#if header}
    <header>{@render header('Title Arg')}</header>
  {/if}
</div>